function memoize(t){var n=Object.keys(t);const r={};for(let e=0;e<n.length;e++){var a=n[e],i=Object.getOwnPropertyDescriptor(t,a);if(i&&i.get){const o=i.get;let e=void 0;Object.defineProperty(r,a,{configurable:!0,enumerable:!0,get(){return void 0!==e?e:e=o()}})}else r[a]=t[a]}return r}"function"!=typeof Array.prototype.at&&(Array.prototype.at=function(e){return e<0?this[this.length-Math.abs(e)]:this[e]}),"undefined"==typeof setImmediate&&(window.setImmediate=e=>setTimeout(e,0));class Filters{static byProps(...e){return t=>e.every(e=>e in t)}static byDisplayName(t,n=!1){return e=>(n?e=e.default:e)&&"function"==typeof e&&e.displayName===t}static byTypeString(...e){return t=>t.type&&(t=t.type?.toString())&&e.every(e=>-1<t.indexOf(e))}}class WebpackModule{get Filters(){return Filters}get chunkName(){return"webpackChunkdiscord_app"}get id(){return Symbol("kernel-settings")}constructor(){this.cache=null,this.whenReady=this.waitForGlobal.then(()=>new Promise(async e=>{const[t,{ActionTypes:n}={},r]=await this.findByProps(["dirtyDispatch"],["API_HOST","ActionTypes"],["getCurrentUser","_dispatchToken"],{cache:!1,bulk:!0,wait:!0,forever:!0});if(r.getCurrentUser())return e();function a(){t.unsubscribe(n.START_SESSION,a),t.unsubscribe(n.CONNECTION_OPEN,a),e()}t.subscribe(n.START_SESSION,a),t.subscribe(n.CONNECTION_OPEN,a)}))}async waitFor(t,{retries:n=100,all:r=!1,forever:a=!1,delay:i=50}={}){for(let e=0;e<n||a;e++){var o=this.findModule(t,{all:r,cache:!1});if(o)return o;await new Promise(e=>setTimeout(e,i))}}parseOptions(e,t=e=>"object"==typeof e&&null!=e&&!Array.isArray(e)){return[e,t(e.at(-1))?e.pop():{}]}request(e=!0){if(e&&this.cache)return this.cache;let t=void 0;var n;return Array.isArray(window[this.chunkName])&&(n=[[this.id],{},e=>t=e],webpackChunkdiscord_app.push(n),webpackChunkdiscord_app.splice(webpackChunkdiscord_app.indexOf(n),1)),t||console.warn("[Webpack] Got empty cache."),e&&(this.cache=t),t}findModule(r,{all:e=!1,cache:t=!0,force:d=!1,default:p=!1}={}){if("function"==typeof r){var a=this.request(t);const c=[];let n=null;if(a){function i(e,t){try{return r(e,t)}catch(e){return n??=e,!1}}for(const l in a.c){var o=a.c[l].exports;if(o&&o!==window)switch(typeof o){case"object":if(i(o,l)){if(!e)return o;c.push(o)}if(o.__esModule&&null!=o.default&&"number"!=typeof o.default&&i(o.default,l)){var s=p?o:o.default;if(!e)return s;c.push(s)}if(d&&o.__esModule)for(const u in o)if(o[u]&&i(o[u],l)){if(!e)return o[u];c.push(o[u])}break;case"function":if(i(o,l)){if(!e)return o;c.push(o)}}}return n&&setImmediate(()=>{console.warn("[Webpack] filter threw an error. This can cause lag spikes at the user's end. Please fix asap.\n\n",n)}),e?c:c[0]}}}findModules(e){return this.findModule(e,{all:!0})}bulk(...e){const[r,{wait:t=!1,...n}]=this.parseOptions(e),a=new Array(r.length),i=t?this.waitFor:this.findModule,o=r.map(t=>("string"==typeof(t=Array.isArray(t)?Filters.byProps(...t):t)&&(t=Filters.byDisplayName(t)),e=>{try{return t(e)}catch(e){return!1}})),s=i.call(this,t=>{for(let e=0;e<o.length;e++){const n=o[e];"function"==typeof n&&n(t)&&null==a[e]&&(a[e]=t)}return a.filter(String).length===r.length},n);return t?s.then(()=>a):a}findByProps(...e){const[t,{bulk:n=!1,wait:r=!1,...a}]=this.parseOptions(e);return n||r?r&&!n?this.waitFor(Filters.byProps(...t),a):n?(e=t.map(e=>Filters.byProps(...e)).concat({wait:r,...a}),this.bulk(...e)):null:this.findModule(Filters.byProps(...t),a)}findByDisplayName(...e){const[t,{bulk:n=!1,wait:r=!1,...a}]=this.parseOptions(e);if(!n&&!r)return this.findModule(Filters.byDisplayName(t[0]),a);if(r&&!n)return this.waitFor(Filters.byDisplayName(t[0]),a);if(n){const i=t.map(i.map(Filters.byDisplayName)).concat({wait:r,cache:cache});return this.bulk(...i)}return null}findIndex(n){let r=-1;return this.findModule((e,t)=>{n(e)&&(r=t)}),r}atIndex(e){return this.request(!0)?.c[e]}get waitForGlobal(){return new Promise(async e=>{for(;!Array.isArray(window[this.chunkName]);)await new Promise(setImmediate);e()})}async wait(e=null){return this.whenReady.then(()=>{"function"==typeof e&&e()})}get whenExists(){return this.waitForGlobal}on(e,t){if("LOADED"===e)return this.whenReady.then(t)}get once(){return this.on}}const Webpack=new WebpackModule,DiscordComponents=memoize({get Button(){return Webpack.findByProps("BorderColors")},get Switch(){return Webpack.findByDisplayName("Switch")},get Markdown(){return Webpack.findModule(e=>"Markdown"===e.displayName&&"rules"in e)},get Header(){return Webpack.findModule(e=>"Header"===e.displayName&&"Tags"in e)},get Text(){return Webpack.findByDisplayName("Text")},get Forms(){return Webpack.findByProps("FormItem","FormTitle")},get Icons(){const e=Webpack.findModules(e=>"function"==typeof e&&e.displayName&&-1<e.toString().indexOf("currentColor"));return Object.fromEntries(e.map(e=>[e.displayName,e]))},get Tooltips(){var e=Webpack.findByProps("TooltipContainer");return{Container:e.TooltipContainer,Tooltip:e.default,...e}}}),kernel$1=window.kernel,Electron=SettingsNative.requireModule("electron");function Icon({name:e,...t}){e=DiscordComponents.Icons[e]??(()=>null);return t.size??="16",React.createElement(e,Object.assign({},t,{width:t.size,height:t.size}))}function ToolButton({label:e,icon:t,onClick:n,danger:r=!1}){const{Tooltips:a,Button:i}=DiscordComponents;return React.createElement(a.Tooltip,{text:e,position:"top"},e=>React.createElement(i,Object.assign({},e,{className:"kernel-toolbutton",look:i.Looks.BLANK,size:i.Sizes.NONE,onClick:n}),React.createElement(Icon,{size:"20",name:t,color:r?"#ed4245":void 0})))}function SwitchWrapper({value:e,onChange:t,disabled:n}){var r=DiscordComponents["Switch"];const[a,i]=React.useState(e);return React.createElement(r,{checked:a,disabled:n,onChange:React.useCallback(()=>{n||(t(!a),i(e=>!e))},[t,a])})}function openItem(e){if(e.endsWith(".asar"))return Electron.showItemInFolder(e);Electron.openPath(e)}function KernelCard({pkg:t}){var{Markdown:e,Text:n}=DiscordComponents;return React.createElement("div",{className:"kernel-card"},React.createElement("div",{className:"kernel-card-tools"},React.createElement(ToolButton,{label:"Open Path",icon:"Folder",onClick:()=>openItem(t.path)}),React.createElement(ToolButton,{danger:!0,label:"Delete",icon:"Trash",onClick:()=>Electron.trashItem(t.path)})),React.createElement("div",{className:"kernel-card-header"},React.createElement(n,{className:"kernel-card-name"},t.name)),null!=t.description&&React.createElement(n,{className:"kernel-card-desc"},React.createElement(e,null,t.description)),React.createElement("div",{className:"kernel-footer"},React.createElement(SwitchWrapper,{value:t.enabled,disabled:"kernel-settings"===t.id,onChange:e=>{e?kernel$1.packages.startPackage(t.id):kernel$1.packages.stopPackage(t.id)}})))}const kernel=window.kernel;function KernelPanel(){var{FormTitle:e}=DiscordComponents["Forms"];return React.createElement("div",{className:"kernel-panel"},React.createElement(e,{tag:e.Tags.H1},"Packages"),React.createElement("div",{className:"kernel-card-scroller"},Object.values(kernel.packages.getPackages()).map(e=>React.createElement(KernelCard,{pkg:e,key:e.id??e.name}))))}var Logger,Patcher,SettingsRenderer,Core;!function(e){function n(e,t,...n){console[function(e){switch(e){case"error":case"info":case"error":return e;default:return"log"}}(e)](`%c[KernelSettings]%c %c[${t}]%c`,"color: #A8D46B; font-weight: 700;","","color: #A8D46B","",...n)}e.log=function(e,...t){n("log",e,...t)},e.info=function(e,...t){n("info",e,...t)},e.warn=function(e,...t){n("warn",e,...t)},e.error=function(e,...t){n("error",e,...t)}}(Logger=Logger||{}),function(e){const o=new Set;e.patch=function(e,t,n,r=!1){const a=e[t];var i=()=>{e[t]=a};return e[t]=function(){if(r)try{Reflect.apply(n,this,arguments)}catch(e){console.error("[Kernel:patcher] Error during before patch:",e)}let e=Reflect.apply(a,this,arguments);if(r)return e;try{var t=Reflect.apply(n,this,[arguments,e]);null!=t&&(e=t)}catch(e){console.error("[Kernel:patcher] Error during patch:",e)}return e},Object.assign(e[t],a,{toString(){return a.toString()}}),o.add(i),i},e.unpatchAll=function(){for(const e of o)e()}}(Patcher=Patcher||{}),function(e){let t=!1;e.panels=[{section:"DIVIDER"},{section:"HEADER",label:"Kernel",id:"kernel-settings"}],e.register=function(e,t){const n={section:"Kernel-"+e,label:e,id:"kernel-settings-"+e,className:"kernel-settings",element:"function"==typeof t?t:t.render};return SettingsRenderer.panels.push(n),()=>{var e=SettingsRenderer.panels.indexOf(n);return!(e<0)&&(SettingsRenderer.panels.splice(e,1),!0)}},e.initialize=function(){var e;t||(t=!0,e=Webpack.findByDisplayName("SettingsView"),Patcher.patch(e.prototype,"getPredicateSections",function(e,t){var n;Array.isArray(t)&&t.some(e=>"changelog"===e?.section?.toLowerCase())&&!t.some(e=>"kernel-settings"===e?.id)&&((n=t.findIndex(e=>"changelog"===e?.section?.toLowerCase())-1)<0||t.splice(n,0,...SettingsRenderer.panels))}))}}(SettingsRenderer=SettingsRenderer||{});const fs=SettingsNative.requireModule("fs"),path=SettingsNative.requireModule("path");!function(e){let t=null;function n(){Object.defineProperties(window,{KernelSettings:{value:Object.freeze(SettingsRenderer),configurable:!1,writable:!1}})}function r(){var e=path.resolve(fs.current,"style.css");fs.isFile(e)&&(e=fs.readFile(e,"utf8"),t=document.head.appendChild(Object.assign(document.createElement("style"),{id:"kernel-style",textContent:e})))}e.start=async function(){await Webpack.whenReady,Logger.log("Core","Started."),window.React=Webpack.findByProps("createElement","useEffect"),SettingsRenderer.initialize(),SettingsRenderer.register("Packages",()=>React.createElement(KernelPanel,null)),r(),n()},e.exposeGlobals=n,e.loadStyles=r,e.stop=function(){Patcher.unpatchAll(),t?.remove()}}(Core=Core||{});export{Core};
